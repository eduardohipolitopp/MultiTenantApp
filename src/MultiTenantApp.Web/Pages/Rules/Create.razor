@page "/rules/create"
@using MultiTenantApp.Web.Models.DTOs
@using MultiTenantApp.Web.Services
@using MultiTenantApp.Web.Resources.Pages
@using RulesRes = MultiTenantApp.Web.Resources.Pages.Rules
@inject IRuleService RuleService
@inject NavigationManager Navigation
@inject ISnackbar Snackbar

<MudText Typo="Typo.h4" Class="mb-4">@RulesRes.RulesManagementTitle</MudText>

<MudPaper Class="pa-4">
    <EditForm Model="@model" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        
        <MudTextField @bind-Value="model.Name" 
                      Label="Name" 
                      Required="true"
                      Variant="Variant.Outlined"
                      Class="mb-3" />
        
        <MudTextField @bind-Value="model.Description" 
                      Label="Description" 
                      Lines="3"
                      Variant="Variant.Outlined"
                      Class="mb-3" />
        
        <MudButton ButtonType="ButtonType.Submit" 
                   Variant="Variant.Filled" 
                   Color="Color.Primary">
            @RulesRes.AddRuleButton
        </MudButton>
        <MudButton Variant="Variant.Outlined" 
                   Color="Color.Secondary"
                   Href="/rules"
                   Class="ml-2">
            Cancel
        </MudButton>
    </EditForm>
</MudPaper>

@code {
    private CreateRuleDto model = new CreateRuleDto();

    private async Task HandleSubmit()
    {
        try
        {
            await RuleService.CreateRule(model);
            Snackbar.Add("Rule created successfully", Severity.Success);
            Navigation.NavigateTo("/rules");
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error: {ex.Message}", Severity.Error);
        }
    }
}
